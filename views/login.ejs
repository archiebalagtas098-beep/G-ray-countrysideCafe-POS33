<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <title>Login</title>
    <script src="/script/session-manager.js"></script>
</head>
<body>
<form action="/login" method="post">

    <div class="login-border">
        <div class="login-container">
            <div class="logo-container">
                <img src="/logo.png" alt="Logo" class="logo">
            </div>
            <div class="gray-brandname">
                Gray Countryside Cafe
            <h2>Login</h2>
            <div class="input-container">
                <label for="username">Username</label>
                <input type="text" id="username" class="input-type" name="user" required>
            </div>
            <div class="input-container password-group">
                <label for="password">Password</label>
                <div class="password-wrapper">
                    <input type="password" id="password" class="input-type" name="pass" required>
                    <span class="toggle-password" onclick="togglePassword()">
                        <img src="/see.png" alt="Show password" id="eyeIcon">
                    </span>
                </div>
            </div>
                <div class="button-container">
                <button type="submit">Login</button>
            </div>
        </div>
    </div>

</form>
<footer>
    <h5>&copy; 2026 For School Purposes Only. All rights reserved.</h5>
</footer>
<script>
// ==================== ðŸ” CHECK IF ALREADY LOGGED IN ====================
window.addEventListener('load', function() {
    // Check if user has a valid session
    const token = document.cookie.split('; ').find(row => row.startsWith('token='));
    const role = sessionManager.getRole();
    
    if (token && role && sessionManager.isLoggedIn()) {
        // User is already logged in with valid session
        console.log('ðŸ”“ Active session found - redirecting to ' + role + ' interface');
        window.location.href = sessionManager.getDashboardUrl();
    } else if (token) {
        // Token exists but no role in sessionStorage, let server verify
        console.log('ðŸ”„ Token exists, verifying with server...');
        window.location.href = '/';
    }
});

function togglePassword() {
    const passwordInput = document.getElementById("password");
    const eyeIcon = document.getElementById("eyeIcon");

    if (passwordInput.type === "password") {
        passwordInput.type = "text";
        eyeIcon.src = "/blind.png";
        eyeIcon.alt = "Hide password";
    } else {
        passwordInput.type = "password";
        eyeIcon.src = "/see.png";
        eyeIcon.alt = "Show password";
    }
}

// ==================== ðŸŽ¯ HANDLE LOGOUT REDIRECT ====================
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const fromLogout = urlParams.get('logout');
    
    if (fromLogout === 'true') {
        console.log('âœ… Logged out successfully');
        sessionManager.clearSession();
        // Clean up URL
        window.history.replaceState({}, document.title, '/login');
    }
});
</script>
</body>
</html>